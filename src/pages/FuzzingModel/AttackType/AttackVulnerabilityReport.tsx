import React, { useState } from "react";

import { useLocation } from "react-router-dom";
import { besecureMlAssessmentDataStore } from "../../../dataStore";
import { verifyLink } from "../../BesVersionHistory/AssessmentReport";
import Card from "@mui/material/Card";
import MKTypography from "../../../components/MKTypography";
import Divider from "@mui/material/Divider";
import MKBox from "../../../components/MKBox";

export const dividerDiv = () => {
  return <Divider sx={{ my: 0.5, color: "black" }} />;
};

function AttackSummary({ data }: any) {
  return (
    <MKBox pl={1}>
      <MKTypography color="black" textAlign="left" sx={{ fontSize: "10px" }}>
        Adversarial Efficacy (max):{" "}
        {data["overview"]["Adversarial Efficacy (max)"]}{" "}
      </MKTypography>
      <MKTypography color="black" textAlign="left" sx={{ fontSize: "10px" }}>
        Alert: {data["overview"]["Alert"]}
      </MKTypography>
      <MKTypography color="black" textAlign="left" sx={{ fontSize: "10px" }}>
        Defense recommended: {data["overview"]["Defense recommended"]}
      </MKTypography>
      <MKTypography color="black" textAlign="left" sx={{ fontSize: "10px" }}>
        Original Model Accuracy:{" "}
        {data["performance"]["Original Model Accuracy"]}
      </MKTypography>
      <MKTypography color="black" textAlign="left" sx={{ fontSize: "10px" }}>
        Number of test samples: {data["performance"]["Number of test samples"]}
      </MKTypography>
    </MKBox>
  );
}

function DataNotAvailable() {
  return (
    <MKTypography
      color="black"
      textAlign="center"
      variant="h6"
      sx={{ margin: "auto" }}
    >
      Not Available
    </MKTypography>
  );
}

function AttackVulnerabilityReport({ name, position }: any) {
  const location = useLocation();
  const selectedFuzz: any = location.state.selectedFuzz;
  const [report, setreport]: any = useState({});
  React.useEffect(() => {
    let link = `${besecureMlAssessmentDataStore}/${selectedFuzz.name}/fuzz-test/evasion/VulnerabilityReport.json`;
    verifyLink(link, setreport);
  }, []);
  return (
    <Card
      style={{
        width: "100%",
        marginTop: "13px",
        paddingBottom: '7px'
      }}
    >
      <MKTypography
        variant="h6"
        textAlign="center"
        sx={{ fontSize: "12px" }}
        color={position.color}
        pt={0.4}
        pb={0.4}
      >
        {name}
      </MKTypography>
      {dividerDiv()}
      {report && Object.values(report).length > 0 ? (
        <AttackSummary data={report} />
      ) : (
        <DataNotAvailable />
      )}
    </Card>
  );
}

export default AttackVulnerabilityReport;
